{{ '## auth-ldap.conf' }}
{{ '# ' + ansible_managed }}
{{ '# Do not edit manually' }}

{% for l in vars['openvpn_ldap_settings'] %}
{{ '<LDAP>' }}
{% if l.host is defined and l.host != '' %}
{{ '  ' ~ 'URL ' ~ l.host }}
{% endif %}
{% if l.binddn is defined and l.binddn != '' %}
{{ '  ' ~ 'BindDN \"' ~ l.binddn ~ '\"' }}
{% endif %}
{% if l.password is defined and l.password != '' %}
{{ '  ' ~ 'Password \"' ~ l.password ~ '\"' }}
{% endif %}
{% if l.timeout is defined and l.timeout != '' %}
{{ '  ' ~ 'Timeout ' ~ l.timeout }}
{% endif %}
{% if l.follow_referals is defined and l.follow_referals in ['yes', 'no'] %}
{{ '  ' ~ 'FollowReferrals ' ~ l.follow_referals }}
{% endif %}
{% if l.tls_enable is defined and l.tls_enable in ['yes', 'no'] %}
{{ '  ' ~ 'TLSEnable ' ~ l.tls_enable }}
{% endif %}
{#} not_implemented:
TLSCACertFile
TLSCACertDir
TLSCertFile
TLSKeyFile
TLSCipherSuite {#}
{{ '</LDAP>' }}
{{ '<Authorization>' }}
{% if l.basedn is defined and l.basedn != '' %}
{{ '  ' ~ 'BaseDN \"' ~ l.basedn ~ '\"' }}
{% endif %}
{% if l.filter is defined and l.filter != '' %}
{{ '  ' ~ 'SearchFilter \"' ~ l.filter ~ '\"' }}
{% endif %}
{% if l.require_group is defined and l.require_group in ['true', 'false'] %}
{{ '  ' ~ 'RequireGroup ' ~ l.require_group }}
{{ '    <Group>' }}
{% if l.rfc2307 is defined and l.rfc2307 in ['true', 'false'] %}
{{ '      ' ~ 'RFC2307bis ' ~ l.rfc2307 }}
{% endif %}
{% if l.group_basedn is defined and l.group_basedn != '' %}
{{ '      ' ~ 'BaseDN \"' ~ l.group_basedn ~ '\"' }}
{% endif %}
{% if l.group_filter is defined and l.group_filter != '' %}
{{ '      ' ~ 'SearchFilter \"' ~ l.group_filter ~ '\"' }}
{% endif %}
{% if l.group_attr is defined and l.group_attr != '' %}
{{ '      ' ~ 'MemberAttribute \"' ~ l.group_attr ~ '\"' }}
{% endif %}
{{ '    </Group>' }}
{% endif %}
{{ '</Authorization>' }}
{% endfor %}
