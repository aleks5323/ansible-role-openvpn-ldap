ansible-role-openvpn-ldap
===========================

Role for deploy openvpn server/client/user with LDAP auth and Certificate relocation support 


Example configuration on server with 4 tunnels
-------------------------------------------------

openvpn_default_routes:
  - '5.128.220.1 255.255.255.255'
  - '5.128.220.21 255.255.255.255'
  - '5.128.220.10 255.255.255.255'
openvpn_dest: '/etc/openvpn/'
openvpn_tls_dest: '{{ openvpn_dest }}tls/'
openvpn_client_config_dir: '{{ openvpn_dest }}main/'
openvpn_log_dest: '/var/log/openvpn/'
openvpn_pool_dest: '/var/lib/openvpn/'
openvpn_instance: 'server'
openvpn_server:
- {
name: 'openvpn1194',
port: '1194',
proto: 'udp',
dev: 'tap0',
server: '10.15.0.0 255.255.255.0',
ca: '{{ openvpn_ca_file }}',
cert: '{{ openvpn_instance_name }}.crt',
key: '{{ openvpn_instance_name }}.key',
tls_auth: '{{ openvpn_takey_file }}',
dh: '{{ openvpn_dhparam_file }}',
crl_verify: '{{ openvpn_crl_file }}',
user: '{{ openvpn_instance_user }}',
group: '{{ openvpn_instance_group }}',
client_cert_not_required: 'true',
username_as_common_name: 'true',
multihome: 'true',
persist_key: 'true',
persist_tun: 'true',
keepalive: '10 60',
max_clients: '250',
reneg_sec: '86400',
replay_window: '64',
client_to_client: 'true',
comp_lzo: 'adaptive',
verbosity: '4',
mute: '10',
mute_replay_warnings: 'true',
ifconfig_pool_persist: 'pool1194.txt',
status: 'status1194.log',
push: 'true',
push_comp_lzo: 'adaptive',
push_route: '192.168.0.0 255.255.0.0',
push_persist_key: 'true',
push_persist_tun: 'true',
push_dhcp_option: 'DNS 192.168.128.1',
client_config_dir: 'true',
plugin: 'true',
plugin_name: 'openvpn-auth-ldap.so',
plugin_conf: 'auth-ldap.conf'
}
- {
name: 'openvpn1195',
port: '1195',
proto: 'udp',
dev: 'tap1',
server: '10.16.0.0 255.255.255.0',
ca: '{{ openvpn_ca_file }}',
cert: '{{ openvpn_instance_name }}.crt',
key: '{{ openvpn_instance_name }}.key',
tls_auth: '{{ openvpn_takey_file }}',
dh: '{{ openvpn_dhparam_file }}',
crl_verify: '{{ openvpn_crl_file }}',
user: '{{ openvpn_instance_user }}',
group: '{{ openvpn_instance_group }}',
client_cert_not_required: 'false',
username_as_common_name: 'false',
multihome: 'true',
persist_tun: 'true',
keepalive: '10 60',
max_clients: '250',
reneg_sec: '86400',
replay_window: '64',
client_to_client: 'true',
comp_lzo: 'adaptive',
verbosity: '4',
mute: '10',
mute_replay_warnings: 'true',
ifconfig_pool_persist: 'pool1195.txt',
status: 'status1195.log',
push: 'true',
push_comp_lzo: 'adaptive',
push_persist_key: 'true',
push_persist_tun: 'true',
tls_server: 'true',
tls_version_min: '1.2',
persist_key: 'true',
client_config_dir: 'false',
plugin: 'false'
}
- {
name: 'openvpn1196',
port: '1196',
proto: 'udp',
dev: 'tap2',
server: '10.17.0.0 255.255.255.0',
ca: '{{ openvpn_ca_file }}',
cert: '{{ openvpn_instance_name }}.crt',
key: '{{ openvpn_instance_name }}.key',
tls_auth: '{{ openvpn_takey_file }}',
dh: '{{ openvpn_dhparam_file }}',
crl_verify: '{{ openvpn_crl_file }}',
user: '{{ openvpn_instance_user }}',
group: '{{ openvpn_instance_group }}',
client_cert_not_required: 'false',
username_as_common_name: 'false',
multihome: 'true',
persist_tun: 'true',
keepalive: '10 60',
max_clients: '250',
reneg_sec: '86400',
replay_window: '64',
client_to_client: 'true',
comp_lzo: 'adaptive',
verbosity: '4',
mute: '10',
mute_replay_warnings: 'true',
ifconfig_pool_persist: 'pool1196.txt',
status: 'status1196.log',
push: 'true',
push_comp_lzo: 'adaptive',
push_persist_key: 'true',
push_persist_tun: 'true',
tls_server: 'true',
tls_version_min: '1.2',
persist_key: 'true',
client_config_dir: 'false',
plugin: 'false'
}
- {
name: 'openvpn1197',
port: '1197',
proto: 'udp',
dev: 'tap3',
server: '10.18.0.0 255.255.255.0',
ca: '{{ openvpn_ca_file }}',
cert: '{{ openvpn_instance_name }}.crt',
key: '{{ openvpn_instance_name }}.key',
tls_auth: '{{ openvpn_takey_file }}',
dh: '{{ openvpn_dhparam_file }}',
crl_verify: '{{ openvpn_crl_file }}',
user: '{{ openvpn_instance_user }}',
group: '{{ openvpn_instance_group }}',
client_cert_not_required: 'false',
username_as_common_name: 'false',
duplicate_cn: 'true',
multihome: 'true',
persist_tun: 'true',
keepalive: '10 60',
max_clients: '250',
reneg_sec: '86400',
replay_window: '64',
client_to_client: 'true',
comp_lzo: 'adaptive',
verbosity: '4',
mute: '10',
mute_replay_warnings: 'true',
status: 'status1197.log',
push: 'true',
push_comp_lzo: 'adaptive',
push_persist_key: 'true',
push_persist_tun: 'true',
push_dhcp_option: 'DNS 192.168.128.1',
tls_server: 'true',
tls_version_min: '1.2',
persist_key: 'true',
client_config_dir: 'true',
plugin: 'false'
}